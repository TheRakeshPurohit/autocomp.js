export function autocomp(e,t={}){const o={onQuery:null,onNavigate:null,onSelect:null,onRender:null,debounce:100,autoSelect:!0,...t};let n,l,u,a=o.autoSelect?0:-1,c=[];function i(e){if("keydown"!==e.type||function(e){if(!n)return 38===e.keyCode||40===e.keyCode;switch(e.keyCode){case 38:return r(-1,e);case 40:return r(1,e);case 13:return s(a),void f();case 27:return void f()}}(e)){if("blur"!==e.type)return""===e.target.value?(f(),void(l=null)):void(e.target.value===l&&n||(l=e.target.value,clearTimeout(u),u=setTimeout(d,o.debounce)));f()}}async function d(){l&&(c=await o.onQuery(l),c.length?(n||(n=document.createElement("div"),Object.assign(n.style,{width:window.getComputedStyle(e).width,position:"absolute",left:`${e.offsetLeft}px`,top:`${e.offsetTop+e.offsetHeight}px`}),n.classList.add("autocomp"),e.parentNode.insertBefore(n,e.nextSibling)),n.innerHTML="",c.forEach(((e,t)=>{const l=document.createElement("div");l.classList.add("autocomp-item"),o.onRender?l.appendChild(o.onRender(e)):l.innerText=e,t===a&&l.classList.add("autocomp-sel"),l.addEventListener("mousedown",(()=>s(t))),n.appendChild(l)}))):f())}function r(e,t){t.preventDefault(),console.log("x");const o=n.querySelector(`:nth-child(${a+1})`);o&&o.classList.remove("autocomp-sel"),a=(a+e+c.length)%c.length,n.querySelector(`:nth-child(${a+1})`).classList.add("autocomp-sel")}function s(t){o.onSelect&&(l=o.onSelect(c[t]),e.value=l||c[t])}function f(){c=[],a=o.autoSelect?0:-1,n&&(n.remove(),n=null)}e.autocomplete="off",["input","keydown","blur"].forEach((t=>e.addEventListener(t,i)))}export default autocomp;
